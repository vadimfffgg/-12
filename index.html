<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apex Auto | –ü—Ä–µ–º–∏—É–º –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,300;14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #edf3e8;
            color: #1a2a18;
            padding: 0 24px 40px 24px;
            opacity: 0;
            animation: fadeIn 0.8s cubic-bezier(0.2, 0.9, 0.3, 1) forwards;
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        :root {
            --khaki-deep: #2c3d2a;
            --khaki: #557255;
            --khaki-moss: #7f967c;
            --khaki-light: #c0d2b8;
            --khaki-soft: #dfeadb;
            --card-bg: #ffffff;
            --text-dark: #1a2a18;
            --text-soft: #4d624a;
            --border-light: #d1dec9;
            --shadow-elegant: 0 20px 35px -12px rgba(60, 80, 50, 0.25);
            --toast-success: #4caf7f;
            --toast-error: #cf6f5e;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: white;
            border-left: 5px solid var(--khaki);
            border-radius: 16px;
            padding: 16px 24px;
            margin-bottom: 10px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
            max-width: 350px;
        }

        .toast.success { border-left-color: var(--toast-success); }
        .toast.error { border-left-color: var(--toast-error); }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            to { opacity: 0; transform: translateX(100%); }
        }

        h1, h2, h3 { font-weight: 500; letter-spacing: -0.02em; }
        h1 { font-size: 2rem; }
        h2 { font-size: 1.5rem; margin-bottom: 1.5rem; }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 0;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-light);
        }

        .logo {
            font-size: 1.9rem;
            font-weight: 600;
            color: var(--khaki-deep);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .weather-card {
            background: var(--card-bg);
            padding: 12px 30px;
            border-radius: 60px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.02);
            display: flex;
            align-items: center;
            gap: 20px;
            border: 1px solid var(--border-light);
            transition: all 0.3s;
        }

        .weather-card:hover {
            transform: scale(1.02);
            box-shadow: var(--shadow-elegant);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1.2fr 2fr 1.2fr;
            gap: 24px;
            margin-bottom: 30px;
        }

        .car-card {
            background: var(--card-bg);
            border-radius: 40px;
            padding: 28px;
            box-shadow: var(--shadow-elegant);
            border: 1px solid var(--border-light);
            transition: all 0.3s;
        }

        .car-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 30px 45px -15px rgba(60, 80, 50, 0.3);
        }

        .car-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid var(--border-light);
        }

        .car-field input, .car-field select {
            padding: 8px 16px;
            border-radius: 30px;
            border: 2px solid var(--border-light);
            font-weight: 500;
        }

        .btn-primary {
            background: var(--khaki);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            background: var(--khaki-deep);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(90, 113, 89, 0.3);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--khaki-light);
            padding: 12px 26px;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            margin-left: 10px;
        }

        .widget {
            background: var(--card-bg);
            border-radius: 32px;
            padding: 24px;
            box-shadow: var(--shadow-elegant);
            margin-bottom: 20px;
        }

        .progress-bg {
            height: 8px;
            background: var(--khaki-light);
            border-radius: 20px;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--khaki);
            border-radius: 20px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .quick-card {
            background: var(--card-bg);
            border-radius: 40px;
            padding: 28px;
            box-shadow: var(--shadow-elegant);
        }

        .quick-item {
            display: flex;
            align-items: center;
            gap: 18px;
            padding: 18px 0;
            border-bottom: 1px dashed var(--border-light);
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-item:hover {
            transform: translateX(12px);
            color: var(--khaki-deep);
        }

        .slide-panel {
            display: none;
            background: var(--card-bg);
            border-radius: 48px;
            padding: 35px;
            margin-top: 30px;
            box-shadow: var(--shadow-elegant);
            animation: slideUp 0.5s ease;
        }

        .slide-panel.active {
            display: block;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(30, 45, 30, 0.5);
            backdrop-filter: blur(8px);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 60px;
            padding: 45px;
            width: 90%;
            max-width: 500px;
            animation: modalZoom 0.4s ease;
        }

        @keyframes modalZoom {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-content input, .modal-content textarea, .modal-content select {
            width: 100%;
            padding: 16px 20px;
            margin: 12px 0;
            border: 2px solid var(--border-light);
            border-radius: 50px;
            font-size: 1rem;
        }

        .photo-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 15px 0;
        }

        .photo-thumb {
            width: 80px;
            height: 80px;
            background: var(--khaki-soft);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            object-fit: cover;
        }

        .photo-thumb img {
            width: 100%;
            height: 100%;
            border-radius: 20px;
            object-fit: cover;
        }

        .expiring-badge {
            background: #fae1d7;
            color: #b45f3a;
            padding: 4px 12px;
            border-radius: 40px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .delete-btn {
            background: none;
            border: none;
            color: #b45f3a;
            cursor: pointer;
            font-size: 1.1rem;
            margin-left: 15px;
        }
    </style>
</head>
<body>

    <div class="toast-container" id="toastContainer"></div>

    <header class="header">
        <div class="logo">
            <i class="fas fa-gem"></i> Apex Auto
        </div>
        <div class="weather-card" id="weatherWidget">
            <i class="fas fa-cloud-sun" id="weatherIcon"></i>
            <span id="weatherTemp">--¬∞C</span>
            <span id="weatherCity">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ...</span>
            <span id="weatherAdvice" class="weather-recommend"></span>
        </div>
    </header>

    <div class="dashboard">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="car-card">
            <h3>üìã –ú–æ–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å</h3>
            <div class="car-field"><span>–ú–∞—Ä–∫–∞/–ú–æ–¥–µ–ª—å</span><input type="text" id="carBrand" value="Porsche Cayenne"></div>
            <div class="car-field"><span>VIN</span><input type="text" id="carVin" value="WP1AA29P95LA12345"></div>
            <div class="car-field"><span>–ì–æ—Å–Ω–æ–º–µ—Ä</span><input type="text" id="carPlate" value="A777AA"></div>
            <div class="car-field"><span>–ü—Ä–æ–±–µ–≥, –∫–º</span><input type="number" id="carMileage" value="145000"></div>
            <div class="car-field"><span>–ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞</span><input type="number" id="lastOil" value="140000"></div>
            <div class="car-field"><span>–°–µ–∑–æ–Ω —à–∏–Ω</span>
                <select id="tireSeason"><option value="winter">–ó–∏–º–Ω–∏–µ</option><option value="summer">–õ–µ—Ç–Ω–∏–µ</option></select>
            </div>
            <button class="btn-primary" id="saveCarBtn"><i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>

        <!-- –¶–µ–Ω—Ç—Ä -->
        <div>
            <div class="widget">
                <div class="widget-title"><i class="fas fa-oil-can"></i> –ú–∞—Å–ª–æ</div>
                <div style="display:flex; justify-content:space-between;"><span>–û—Å—Ç–∞–ª–æ—Å—å:</span><span id="oilLeft">5000 –∫–º</span></div>
                <div class="progress-bg"><div class="progress-fill" id="oilProgress"></div></div>
                <button class="btn-primary" id="oilChangeBtn">‚úî –ó–∞–º–µ–Ω–∏–ª –º–∞—Å–ª–æ</button>
            </div>
            <div class="widget">
                <div class="widget-title"><i class="fas fa-thermometer-half"></i> –ü—Ä–æ–≥—Ä–µ–≤</div>
                <div id="warmupText"></div>
                <div id="tireReminder" style="margin-top:15px;"></div>
            </div>
            <div class="widget" id="docsWidget">
                <div class="widget-title"><i class="fas fa-clock"></i> –°—Ä–æ–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</div>
                <div id="expiringDocsList">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
        <div class="quick-card">
            <h3>‚ö° –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø</h3>
            <div class="quick-item" data-panel="docs"><i class="fas fa-lock"></i> –î–æ–∫—É–º–µ–Ω—Ç—ã</div>
            <div class="quick-item" data-panel="finances"><i class="fas fa-chart-pie"></i> –§–∏–Ω–∞–Ω—Å—ã</div>
            <div class="quick-item" data-panel="washes"><i class="fas fa-spray-can"></i> –ú–æ–π–∫–∏</div>
            <div class="quick-item" data-panel="trips"><i class="fas fa-route"></i> –ü–æ–µ–∑–¥–∫–∏</div>
            <div class="quick-item" data-panel="parts"><i class="fas fa-tools"></i> –ó–∞–ø—á–∞—Å—Ç–∏</div>
            <div class="quick-item" data-panel="manual"><i class="fas fa-book"></i> –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ</div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª–∏ -->
    <div id="docs-panel" class="slide-panel">
        <div class="panel-header"><h2>üìÅ –î–æ–∫—É–º–µ–Ω—Ç—ã</h2><button class="btn-primary" id="lockDocs"><i class="fas fa-lock"></i> –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button></div>
        <div id="docsLocked">
            <p>–í–≤–µ–¥–∏—Ç–µ PIN:</p><input type="password" id="docPin" maxlength="4" placeholder="****">
            <button class="btn-primary" id="unlockDocs">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        <div id="docsUnlocked" style="display:none;">
            <div class="car-field">–°–¢–°: <span id="docSts">99–£–£123456</span> –¥–æ <input type="date" id="docStsDate" value="2026-05-12"> <button class="delete-btn" onclick="deleteDoc('sts')"><i class="fas fa-trash"></i></button></div>
            <div class="car-field">–ü–¢–°: <span id="docPts">–±–µ—Å—Å—Ä–æ—á–Ω–æ</span> –¥–æ <input type="date" id="docPtsDate" value="2030-01-01"></div>
            <div class="car-field">–ü—Ä–∞–≤–∞: <span id="docLicense">7712345678</span> –¥–æ <input type="date" id="docLicenseDate" value="2028-09-08"></div>
            <div class="car-field">–°—Ç—Ä–∞—Ö–æ–≤–∫–∞: <span id="docInsurance">–ê–ê–ê123456</span> –¥–æ <input type="date" id="docInsuranceDate" value="2026-01-01"></div>
            <button class="btn-primary" id="saveDocs">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </div>
    </div>

    <div id="finances-panel" class="slide-panel">
        <h2>üí∞ –§–∏–Ω–∞–Ω—Å—ã</h2>
        <canvas id="financeChart" width="400" height="200"></canvas>
        <button class="btn-primary" id="showAddExpenseModal">+ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</button>
        <div id="expenseList"></div>
    </div>

    <div id="washes-panel" class="slide-panel">
        <h2>üßº –ú–æ–π–∫–∏</h2>
        <button class="btn-primary" id="showWashModal">+ –ù–æ–≤–∞—è –º–æ–π–∫–∞</button>
        <div id="washesGrid"></div>
    </div>

    <div id="trips-panel" class="slide-panel">
        <h2>üó∫Ô∏è –ü–æ–µ–∑–¥–∫–∏</h2>
        <button class="btn-primary" id="showTripModal">+ –ù–æ–≤–∞—è –ø–æ–µ–∑–¥–∫–∞</button>
        <div id="tripsGrid"></div>
    </div>

    <div id="parts-panel" class="slide-panel">
        <h2>üîß –ó–∞–º–µ–Ω–∞ –∑–∞–ø—á–∞—Å—Ç–µ–π</h2>
        <button class="btn-primary" id="showPartModal">+ –ó–∞–º–µ–Ω–∞</button>
        <div id="partsList"></div>
    </div>

    <div id="manual-panel" class="slide-panel">
        <h2>üìò –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ</h2>
        <div class="manual-sections" style="display:grid; grid-template-columns:200px 1fr; gap:20px;">
            <div>
                <div class="manual-tab active" data-manual="engine">–î–≤–∏–≥–∞—Ç–µ–ª—å</div>
                <div class="manual-tab" data-manual="oil">–ú–∞—Å–ª–æ</div>
                <div class="manual-tab" data-manual="warmup">–ü—Ä–æ–≥—Ä–µ–≤</div>
                <div class="manual-tab" data-manual="suspension">–ü–æ–¥–≤–µ—Å–∫–∞</div>
                <div class="manual-tab" data-manual="tires">–®–∏–Ω—ã</div>
                <div class="manual-tab" data-manual="brakes">–¢–æ—Ä–º–æ–∑–∞</div>
                <div class="manual-tab" data-manual="cooling">–û—Ö–ª–∞–∂–¥–µ–Ω–∏–µ</div>
                <div class="manual-tab" data-manual="electrics">–≠–ª–µ–∫—Ç—Ä–∏–∫–∞</div>
                <div class="manual-tab" data-manual="transmission">–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è</div>
                <div class="manual-tab" data-manual="exhaust">–í—ã—Ö–ª–æ–ø</div>
            </div>
            <div id="manualContent" style="line-height:1.8;"></div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∏ -->
    <div class="modal" id="expenseModal"><div class="modal-content">
        <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</h3>
        <select id="expenseType"><option value="fuel">–¢–æ–ø–ª–∏–≤–æ</option><option value="repair">–†–µ–º–æ–Ω—Ç</option><option value="wash">–ú–æ–π–∫–∞</option><option value="insurance">–°—Ç—Ä–∞—Ö–æ–≤–∫–∞</option><option value="other">–î—Ä—É–≥–æ–µ</option></select>
        <input type="text" id="expenseDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
        <input type="number" id="expenseAmount" placeholder="–°—É–º–º–∞">
        <input type="number" id="expenseMileage" placeholder="–ü—Ä–æ–±–µ–≥">
        <div><button class="btn-primary" id="saveExpense">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn-secondary" id="cancelExpense">–û—Ç–º–µ–Ω–∞</button></div>
    </div></div>

    <div class="modal" id="washModal"><div class="modal-content">
        <h3>üßΩ –ù–æ–≤–∞—è –º–æ–π–∫–∞</h3>
        <input type="date" id="washDate" value="2026-02-27">
        <input type="text" id="washChem" placeholder="–•–∏–º–∏—è">
        <textarea id="washComment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
        <div class="photo-grid" id="washPhotoPreview"></div>
        <input type="file" id="washFileInput" multiple accept="image/*" style="display:none;">
        <button class="btn-primary" id="addWashPhotosBtn"><i class="fas fa-camera"></i> –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ</button>
        <div><button class="btn-primary" id="saveWash">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn-secondary" id="cancelWash">–û—Ç–º–µ–Ω–∞</button></div>
    </div></div>

    <div class="modal" id="tripModal"><div class="modal-content">
        <h3>üöó –ù–æ–≤–∞—è –ø–æ–µ–∑–¥–∫–∞</h3>
        <input type="date" id="tripDate" value="2026-02-27">
        <input type="time" id="tripTime" value="14:30">
        <input type="text" id="tripFrom" placeholder="–û—Ç–∫—É–¥–∞">
        <input type="text" id="tripTo" placeholder="–ö—É–¥–∞">
        <input type="number" id="tripDistance" placeholder="–ü—Ä–æ–±–µ–≥, –∫–º">
        <div><button class="btn-primary" id="saveTrip">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn-secondary" id="cancelTrip">–û—Ç–º–µ–Ω–∞</button></div>
    </div></div>

    <div class="modal" id="partModal"><div class="modal-content">
        <h3>üîß –ó–∞–º–µ–Ω–∞ –∑–∞–ø—á–∞—Å—Ç–∏</h3>
        <input type="text" id="partName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
        <input type="number" id="partMileage" placeholder="–ü—Ä–æ–±–µ–≥ –ø—Ä–∏ –∑–∞–º–µ–Ω–µ">
        <input type="date" id="partDate" value="2026-02-27">
        <div><button class="btn-primary" id="savePart">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn-secondary" id="cancelPart">–û—Ç–º–µ–Ω–∞</button></div>
    </div></div>

    <script>
        (function() {
            // ========== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ==========
            function showToast(message, type = 'success') {
                const container = document.getElementById('toastContainer');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i> ${message}`;
                container.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }

            // ========== –î–ê–ù–ù–´–ï ==========
            let carData = JSON.parse(localStorage.getItem('carData')) || {
                brand: "Porsche Cayenne", vin: "WP1AA29P95LA12345", plate: "A777AA",
                mileage: 145000, lastOil: 140000, tireSeason: "winter"
            };

            let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
            let washes = JSON.parse(localStorage.getItem('washes')) || [];
            let trips = JSON.parse(localStorage.getItem('trips')) || [];
            let parts = JSON.parse(localStorage.getItem('parts')) || [];
            
            let docs = JSON.parse(localStorage.getItem('docs')) || {
                sts: "99–£–£123456", stsDate: "2026-05-12",
                pts: "–±–µ—Å—Å—Ä–æ—á–Ω–æ", ptsDate: "2030-01-01",
                license: "7712345678", licenseDate: "2028-09-08",
                insurance: "–ê–ê–ê123456", insuranceDate: "2026-01-01"
            };

            let userPin = localStorage.getItem('carPin') || "1234";

            function saveAll() {
                localStorage.setItem('carData', JSON.stringify(carData));
                localStorage.setItem('expenses', JSON.stringify(expenses));
                localStorage.setItem('washes', JSON.stringify(washes));
                localStorage.setItem('trips', JSON.stringify(trips));
                localStorage.setItem('parts', JSON.stringify(parts));
                localStorage.setItem('docs', JSON.stringify(docs));
            }

            // ========== –ê–í–¢–û ==========
            document.getElementById('carBrand').value = carData.brand;
            document.getElementById('carVin').value = carData.vin;
            document.getElementById('carPlate').value = carData.plate;
            document.getElementById('carMileage').value = carData.mileage;
            document.getElementById('lastOil').value = carData.lastOil;
            document.getElementById('tireSeason').value = carData.tireSeason;

            document.getElementById('saveCarBtn').addEventListener('click', function() {
                carData.brand = document.getElementById('carBrand').value;
                carData.vin = document.getElementById('carVin').value;
                carData.plate = document.getElementById('carPlate').value;
                carData.mileage = parseInt(document.getElementById('carMileage').value);
                carData.lastOil = parseInt(document.getElementById('lastOil').value);
                carData.tireSeason = document.getElementById('tireSeason').value;
                saveAll();
                updateOil();
                showToast('‚úÖ –î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
            });

            function updateOil() {
                let kmSince = carData.mileage - carData.lastOil;
                let left = Math.max(0, 7500 - kmSince);
                document.getElementById('oilLeft').innerText = left + ' –∫–º';
                document.getElementById('oilProgress').style.width = Math.min(100, (kmSince/7500)*100) + '%';
            }

            document.getElementById('oilChangeBtn').addEventListener('click', function() {
                carData.lastOil = carData.mileage;
                document.getElementById('lastOil').value = carData.mileage;
                updateOil();
                saveAll();
                showToast('üõ¢Ô∏è –ó–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞');
            });

            // ========== –ì–ï–û–õ–û–ö–ê–¶–ò–Ø ==========
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(pos) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π API –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
                    fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${pos.coords.latitude}&lon=${pos.coords.longitude}`)
                        .then(r => r.json())
                        .then(data => {
                            let city = data.address?.city || data.address?.town || '–í–∞—à –≥–æ—Ä–æ–¥';
                            document.getElementById('weatherCity').innerText = city;
                            // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–≥–æ–¥—ã (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∑–¥–µ—Å—å –∑–∞–ø—Ä–æ—Å –∫ OpenWeatherMap)
                            let temp = -3; // –¥–ª—è –¥–µ–º–æ
                            document.getElementById('weatherTemp').innerText = temp + '¬∞C';
                            document.getElementById('weatherAdvice').innerText = temp < 0 ? '‚ùÑÔ∏è –ú–æ–π–∫–∞ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è' : '‚òÄÔ∏è –ú–æ–∂–Ω–æ –º—ã—Ç—å';
                            document.getElementById('weatherIcon').className = temp < 0 ? 'fas fa-snowflake' : 'fas fa-sun';
                            
                            let warmup = temp < -10 ? '–ü—Ä–æ–≥—Ä–µ–≤ 10-15 –º–∏–Ω' : temp < 0 ? '–ü—Ä–æ–≥—Ä–µ–≤ 5-7 –º–∏–Ω' : '–ü—Ä–æ–≥—Ä–µ–≤ 1-2 –º–∏–Ω';
                            document.getElementById('warmupText').innerText = warmup;

                            let shouldBe = temp < 5 ? 'winter' : 'summer';
                            if (carData.tireSeason !== shouldBe) {
                                document.getElementById('tireReminder').innerHTML = `‚ö†Ô∏è –ü–æ –ø–æ–≥–æ–¥–µ –ø–æ—Ä–∞ –º–µ–Ω—è—Ç—å —à–∏–Ω—ã –Ω–∞ ${shouldBe === 'winter' ? '–∑–∏–º–Ω–∏–µ' : '–ª–µ—Ç–Ω–∏–µ'}. <button class="btn-primary" id="changeTireBtn" style="padding:5px 15px;">–°–º–µ–Ω–∏—Ç—å</button>`;
                                document.getElementById('changeTireBtn')?.addEventListener('click', function() {
                                    carData.tireSeason = shouldBe;
                                    document.getElementById('tireSeason').value = shouldBe;
                                    saveAll();
                                    document.getElementById('tireReminder').innerHTML = '';
                                    showToast('üõû –°–µ–∑–æ–Ω —à–∏–Ω –æ–±–Ω–æ–≤–ª—ë–Ω');
                                });
                            }
                        });
                });
            }

            // ========== –ü–ê–ù–ï–õ–ò ==========
            document.querySelectorAll('.quick-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.slide-panel').forEach(p => p.classList.remove('active'));
                    document.getElementById(this.dataset.panel + '-panel').classList.add('active');
                });
            });

            // ========== –î–û–ö–£–ú–ï–ù–¢–´ ==========
            document.getElementById('unlockDocs').addEventListener('click', function() {
                if (document.getElementById('docPin').value === userPin) {
                    document.getElementById('docsLocked').style.display = 'none';
                    document.getElementById('docsUnlocked').style.display = 'block';
                    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è
                    document.getElementById('docSts').innerText = docs.sts;
                    document.getElementById('docStsDate').value = docs.stsDate;
                    document.getElementById('docPtsDate').value = docs.ptsDate;
                    document.getElementById('docLicenseDate').value = docs.licenseDate;
                    document.getElementById('docInsuranceDate').value = docs.insuranceDate;
                } else showToast('–ù–µ–≤–µ—Ä–Ω—ã–π PIN', 'error');
            });

            document.getElementById('lockDocs').addEventListener('click', function() {
                document.getElementById('docsLocked').style.display = 'block';
                document.getElementById('docsUnlocked').style.display = 'none';
            });

            document.getElementById('saveDocs').addEventListener('click', function() {
                docs.stsDate = document.getElementById('docStsDate').value;
                docs.ptsDate = document.getElementById('docPtsDate').value;
                docs.licenseDate = document.getElementById('docLicenseDate').value;
                docs.insuranceDate = document.getElementById('docInsuranceDate').value;
                saveAll();
                updateExpiringDocs();
                showToast('üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
            });

            function updateExpiringDocs() {
                let today = new Date();
                let expiring = [];
                if (new Date(docs.stsDate) - today < 30*24*60*60*1000) expiring.push(`–°–¢–° –¥–æ ${docs.stsDate}`);
                if (new Date(docs.licenseDate) - today < 30*24*60*60*1000) expiring.push(`–ü—Ä–∞–≤–∞ –¥–æ ${docs.licenseDate}`);
                if (new Date(docs.insuranceDate) - today < 30*24*60*60*1000) expiring.push(`–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –¥–æ ${docs.insuranceDate}`);
                document.getElementById('expiringDocsList').innerHTML = expiring.length ? expiring.map(d => `<div>‚ö†Ô∏è ${d}</div>`).join('') : '‚úÖ –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –ø–æ—Ä—è–¥–∫–µ';
            }
            updateExpiringDocs();

            // ========== –§–ò–ù–ê–ù–°–´ ==========
            let chart;
            function updateFinanceChart() {
                let ctx = document.getElementById('financeChart').getContext('2d');
                let categories = ['fuel','repair','wash','insurance','other'];
                let labels = ['–¢–æ–ø–ª–∏–≤–æ','–†–µ–º–æ–Ω—Ç','–ú–æ–π–∫–∞','–°—Ç—Ä–∞—Ö–æ–≤–∫–∞','–î—Ä—É–≥–æ–µ'];
                let data = categories.map(cat => expenses.filter(e => e.type === cat).reduce((s,e) => s + e.amount, 0));
                if (chart) chart.destroy();
                chart = new Chart(ctx, { type: 'doughnut', data: { labels, datasets: [{ data, backgroundColor: ['#557255','#7f967c','#b45f3a','#7aa5b9','#c0d2b8'] }] } });
            }

            function renderExpenses() {
                let list = document.getElementById('expenseList');
                list.innerHTML = expenses.map((e,i) => `<div style="padding:10px; border-bottom:1px solid var(--border-light);">${e.desc} - ${e.amount}‚ÇΩ <button class="delete-btn" onclick="deleteExpense(${i})"><i class="fas fa-trash"></i></button></div>`).join('');
            }

            window.deleteExpense = function(i) {
                expenses.splice(i,1);
                saveAll();
                updateFinanceChart();
                renderExpenses();
                showToast('–†–∞—Å—Ö–æ–¥ —É–¥–∞–ª—ë–Ω');
            };

            document.getElementById('showAddExpenseModal').addEventListener('click', () => document.getElementById('expenseModal').classList.add('active'));
            document.getElementById('cancelExpense').addEventListener('click', () => document.getElementById('expenseModal').classList.remove('active'));
            document.getElementById('saveExpense').addEventListener('click', function() {
                expenses.push({
                    type: document.getElementById('expenseType').value,
                    desc: document.getElementById('expenseDesc').value,
                    amount: parseFloat(document.getElementById('expenseAmount').value),
                    mileage: parseInt(document.getElementById('expenseMileage').value)
                });
                saveAll();
                updateFinanceChart();
                renderExpenses();
                document.getElementById('expenseModal').classList.remove('active');
                showToast('üí∞ –†–∞—Å—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω');
            });

            // ========== –ú–û–ô–ö–ò ==========
            function renderWashes() {
                let grid = document.getElementById('washesGrid');
                grid.innerHTML = washes.map((w,i) => `
                    <div style="background:var(--khaki-soft); border-radius:24px; padding:16px;">
                        <strong>${w.date}</strong> ${w.chem}<br>
                        <div class="photo-grid">${w.photos ? w.photos.map(p => `<div class="photo-thumb"><img src="${p}"></div>`).join('') : ''}</div>
                        ${w.comment}
                        <button class="delete-btn" onclick="deleteWash(${i})"><i class="fas fa-trash"></i></button>
                    </div>
                `).join('');
            }

            window.deleteWash = function(i) {
                washes.splice(i,1);
                saveAll();
                renderWashes();
                showToast('üßº –ú–æ–π–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
            };

            document.getElementById('showWashModal').addEventListener('click', () => document.getElementById('washModal').classList.add('active'));
            document.getElementById('cancelWash').addEventListener('click', () => document.getElementById('washModal').classList.remove('active'));
            document.getElementById('addWashPhotosBtn').addEventListener('click', () => document.getElementById('washFileInput').click());
            document.getElementById('washFileInput').addEventListener('change', function(e) {
                let preview = document.getElementById('washPhotoPreview');
                preview.innerHTML = '';
                Array.from(e.target.files).forEach(file => {
                    let reader = new FileReader();
                    reader.onload = ev => {
                        let img = document.createElement('img');
                        img.src = ev.target.result;
                        img.className = 'photo-thumb';
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
            });

            document.getElementById('saveWash').addEventListener('click', function() {
                let photos = [];
                document.querySelectorAll('#washPhotoPreview img').forEach(img => photos.push(img.src));
                washes.push({
                    date: document.getElementById('washDate').value,
                    chem: document.getElementById('washChem').value,
                    comment: document.getElementById('washComment').value,
                    photos: photos
                });
                saveAll();
                renderWashes();
                document.getElementById('washModal').classList.remove('active');
                showToast('üßº –ú–æ–π–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
            });

            // ========== –ü–û–ï–ó–î–ö–ò ==========
            function renderTrips() {
                let grid = document.getElementById('tripsGrid');
                grid.innerHTML = trips.map((t,i) => `<div style="padding:12px; border-bottom:1px solid var(--border-light);">${t.date} ${t.time} | ${t.from} ‚Üí ${t.to} | ${t.distance} –∫–º <button class="delete-btn" onclick="deleteTrip(${i})"><i class="fas fa-trash"></i></button></div>`).join('');
            }

            window.deleteTrip = function(i) {
                trips.splice(i,1);
                saveAll();
                renderTrips();
                showToast('üó∫Ô∏è –ü–æ–µ–∑–¥–∫–∞ —É–¥–∞–ª–µ–Ω–∞');
            };

            document.getElementById('showTripModal').addEventListener('click', () => document.getElementById('tripModal').classList.add('active'));
            document.getElementById('cancelTrip').addEventListener('click', () => document.getElementById('tripModal').classList.remove('active'));
            document.getElementById('saveTrip').addEventListener('click', function() {
                trips.push({
                    date: document.getElementById('tripDate').value,
                    time: document.getElementById('tripTime').value,
                    from: document.getElementById('tripFrom').value,
                    to: document.getElementById('tripTo').value,
                    distance: document.getElementById('tripDistance').value
                });
                saveAll();
                renderTrips();
                document.getElementById('tripModal').classList.remove('active');
                showToast('üöó –ü–æ–µ–∑–¥–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞');
            });

            // ========== –ó–ê–ü–ß–ê–°–¢–ò ==========
            function renderParts() {
                let list = document.getElementById('partsList');
                list.innerHTML = parts.map((p,i) => `<div style="padding:10px;">${p.date} | ${p.name} | –ø—Ä–æ–±–µ–≥ ${p.mileage} –∫–º <button class="delete-btn" onclick="deletePart(${i})"><i class="fas fa-trash"></i></button></div>`).join('');
            }

            window.deletePart = function(i) {
                parts.splice(i,1);
                saveAll();
                renderParts();
                showToast('üîß –ó–∞–ø—á–∞—Å—Ç—å —É–¥–∞–ª–µ–Ω–∞');
            };

            document.getElementById('showPartModal').addEventListener('click', () => document.getElementById('partModal').classList.add('active'));
            document.getElementById('cancelPart').addEventListener('click', () => document.getElementById('partModal').classList.remove('active'));
            document.getElementById('savePart').addEventListener('click', function() {
                parts.push({
                    name: document.getElementById('partName').value,
                    mileage: document.getElementById('partMileage').value,
                    date: document.getElementById('partDate').value
                });
                saveAll();
                renderParts();
                document.getElementById('partModal').classList.remove('active');
                showToast('üîß –ó–∞–º–µ–Ω–∞ –∑–∞–ø—á–∞—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
            });

            // ========== –†–£–ö–û–í–û–î–°–¢–í–û ==========
            const manualTexts = {
                engine: '–î–≤–∏–≥–∞—Ç–µ–ª—å: –æ–±—ä—ë–º 3.6 –ª, –º–æ—â–Ω–æ—Å—Ç—å 300 –ª.—Å. –ú–∞—Å–ª–æ 5W-30, –∑–∞–º–µ–Ω–∞ –∫–∞–∂–¥—ã–µ 7500 –∫–º. –°–≤–µ—á–∏ –∑–∞–∂–∏–≥–∞–Ω–∏—è –∫–∞–∂–¥—ã–µ 60 000 –∫–º. –†–µ–º–µ–Ω—å –ì–†–ú –∫–∞–∂–¥—ã–µ 90 000 –∫–º. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ —Ä–∞–∑ –≤ 2 –≥–æ–¥–∞.',
                oil: '–ú–æ—Ç–æ—Ä–Ω–æ–µ –º–∞—Å–ª–æ: –¥–æ–ø—É—Å–∫ Porsche A40. –£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é. –ü—Ä–∏ –∑–∞–º–µ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ 7.5 –ª. –ò–Ω—Ç–µ—Ä–≤–∞–ª –∑–∞–º–µ–Ω—ã 7500 –∫–º –∏–ª–∏ —Ä–∞–∑ –≤ –≥–æ–¥. –ü—Ä–∏ —Ç—è–∂—ë–ª—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —Å–æ–∫—Ä–∞—Ç–∏—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ 5000 –∫–º.',
                warmup: '–ü—Ä–æ–≥—Ä–µ–≤: –ø—Ä–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞—Ö –ø—Ä–æ–≥—Ä–µ–≤–∞–π—Ç–µ –¥–æ –ø–∞–¥–µ–Ω–∏—è –æ–±–æ—Ä–æ—Ç–æ–≤ –•–•. –ù–∞—á–∏–Ω–∞–π—Ç–µ –¥–≤–∏–∂–µ–Ω–∏–µ –ø–ª–∞–≤–Ω–æ. –ò–∑–±–µ–≥–∞–π—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–µ–≤–∞ –Ω–∞ –º–µ—Å—Ç–µ –±–æ–ª–µ–µ 10 –º–∏–Ω—É—Ç.',
                suspension: '–ü–æ–¥–≤–µ—Å–∫–∞: –ø–Ω–µ–≤–º–∞—Ç–∏—á–µ—Å–∫–∞—è, –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–∑ –≤ –≥–æ–¥ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç —É—Ç–µ—á–µ–∫. –ü—Ä–∏–∑–Ω–∞–∫–∏ –∏–∑–Ω–æ—Å–∞ ‚Äì —Å—Ç—É–∫–∏. –ó–∞–º–µ–Ω–∞ –∞–º–æ—Ä—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤ –∫–∞–∂–¥—ã–µ 80 000 –∫–º. –†–µ–≥—É–ª—è—Ä–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∫–æ–ª—ë—Å.',
                tires: '–®–∏–Ω—ã: –¥–∞–≤–ª–µ–Ω–∏–µ 2.3 –∞—Ç–º. –ì–ª—É–±–∏–Ω–∞ –ø—Ä–æ—Ç–µ–∫—Ç–æ—Ä–∞ –Ω–µ –º–µ–Ω–µ–µ 4 –º–º –∑–∏–º–æ–π, 2 –º–º –ª–µ—Ç–æ–º. –ú–µ–Ω—è—Ç—å –ø—Ä–∏ –∏–∑–Ω–æ—Å–µ. –•—Ä–∞–Ω–µ–Ω–∏–µ —à–∏–Ω –≤ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏. –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Å–º–µ–Ω–µ.',
                brakes: '–¢–æ—Ä–º–æ–∑–∞: –∫–æ–ª–æ–¥–∫–∏ –º–µ–Ω—è—Ç—å –∫–∞–∂–¥—ã–µ 30 000 –∫–º, –¥–∏—Å–∫–∏ ‚Äì 60 000 –∫–º. –¢–æ—Ä–º–æ–∑–Ω–∞—è –∂–∏–¥–∫–æ—Å—Ç—å –∫–∞–∂–¥—ã–µ 2 –≥–æ–¥–∞. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏–∑–Ω–æ—Å –¥–∞—Ç—á–∏–∫–æ–≤.',
                cooling: '–û—Ö–ª–∞–∂–¥–µ–Ω–∏–µ: –∞–Ω—Ç–∏—Ñ—Ä–∏–∑ G12++, –∑–∞–º–µ–Ω–∞ –∫–∞–∂–¥—ã–µ 60 000 –∫–º. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Ä–∞–¥–∏–∞—Ç–æ—Ä–∞. –ù–µ —Å–º–µ—à–∏–≤–∞–π—Ç–µ —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –∞–Ω—Ç–∏—Ñ—Ä–∏–∑–∞.',
                electrics: '–≠–ª–µ–∫—Ç—Ä–∏–∫–∞: –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä 70 –ê—á, –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∫–∞–∂–¥—ã–µ 50 000 –∫–º. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–∫–∏—Å–ª–µ–Ω–∏–µ–º –∫–ª–µ–º–º. –ó–∞–º–µ–Ω–∞ –ª–∞–º–ø –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.',
                transmission: '–¢—Ä–∞–Ω—Å–º–∏—Å—Å–∏—è: –º–∞—Å–ª–æ –≤ –ê–ö–ü–ü –∫–∞–∂–¥—ã–µ 60 000 –∫–º. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¢–û. –ò–∑–±–µ–≥–∞–π—Ç–µ –±—É–∫—Å–∏—Ä–æ–≤–∫–∏ —Ç—è–∂—ë–ª—ã—Ö –ø—Ä–∏—Ü–µ–ø–æ–≤.',
                exhaust: '–í—ã—Ö–ª–æ–ø–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞: –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø—Ä–æ—Ç–µ—á–µ–∫, –∫–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä ‚Äì —Ä–µ—Å—É—Ä—Å 150 000 –∫–º. –°–∞–∂–µ–≤—ã–π —Ñ–∏–ª—å—Ç—Ä —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–µ 500 –∫–º —Ç—Ä–∞—Å—Å—ã.'
            };

            document.querySelectorAll('.manual-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.manual-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    document.getElementById('manualContent').innerText = manualTexts[this.dataset.manual];
                });
            });

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            updateOil();
            updateFinanceChart();
            renderExpenses();
            renderWashes();
            renderTrips();
            renderParts();
        })();
    </script>
</body>
</html>